/**
 * MoveOut Theme & Language Manager
 * Handles dark/light mode and Swedish/English translations
 */

// ===== Theme Manager =====
const ThemeManager = {
  init() {
    const savedTheme = localStorage.getItem('moveout-theme') || 'dark';
    this.setTheme(savedTheme);
  },

  setTheme(theme) {
    document.documentElement.setAttribute('data-theme', theme);
    localStorage.setItem('moveout-theme', theme);
    
    // Update toggle button icon (using Font Awesome)
    const toggleBtn = document.getElementById('theme-toggle');
    if (toggleBtn) {
      toggleBtn.innerHTML = theme === 'dark' ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
      // Use translation for tooltip if LanguageManager is available
      const lang = localStorage.getItem('moveout-lang') || 'en';
      if (lang === 'sv') {
        toggleBtn.title = theme === 'dark' ? 'Byt till ljust läge' : 'Byt till mörkt läge';
      } else {
        toggleBtn.title = theme === 'dark' ? 'Switch to Light Mode' : 'Switch to Dark Mode';
      }
    }
    
    // Update nav link colors
    this.updateNavLinks(theme);
    
    // Update header background
    this.updateHeader(theme);
  },

  updateNavLinks(theme) {
    const isDark = theme === 'dark';
    const color = isDark ? '#ffffff' : '#1a1a2e';
    const navLinks = document.querySelectorAll('.nav-link');
    
    // Only set color - let CSS handle background/hover effects
    navLinks.forEach(link => {
      link.style.setProperty('color', color, 'important');
      link.style.setProperty('-webkit-text-fill-color', color, 'important');
    });
  },

  updateHeader(theme) {
    const header = document.querySelector('header');
    if (header) {
      // Remove inline styles to let CSS variables control the colors
      header.style.background = '';
    }
    
    // Update footer as well
    this.updateFooter(theme);
  },

  updateFooter(theme) {
    const footer = document.querySelector('.footer-new');
    if (footer) {
      // CSS variables will handle the colors, just ensure it's visible
      footer.style.transition = 'background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease';
    }
  },

  toggle() {
    const currentTheme = localStorage.getItem('moveout-theme') || 'dark';
    const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
    this.setTheme(newTheme);
  }
};

// ===== Language Manager =====
const translations = {
  en: {
    // Navigation
    about: 'About',
    admin: 'Admin',
    profile: 'Profile',
    myBoxes: 'My Boxes',
    addBox: 'Add Box',
    logout: 'Logout',
    login: 'Login',
    register: 'Register',
    
    // Login Page
    loginTitle: 'Login to MoveOut',
    email: 'Email',
    password: 'Password',
    enterEmail: 'Enter your email',
    enterPassword: 'Enter your password',
    loginBtn: 'Login',
    forgotPassword: 'Forgot password?',
    noAccount: "Don't have an account?",
    signUp: 'Sign Up',
    loginWithGoogle: 'Login with Google',
    
    // Register Page
    signUpTitle: 'Sign Up',
    createAccountInfo: 'Create an account to start organizing your move',
    name: 'Name',
    enterName: 'Enter your name',
    confirmPassword: 'Confirm Password',
    createPassword: 'Create a password',
    repeatPassword: 'Repeat your password',
    signUpBtn: 'Sign Up',
    haveAccount: 'Already have an account?',
    loginHere: 'Login here',
    
    // Profile Page
    profileOverview: 'Profile Overview',
    updateProfile: 'Update Profile',
    currentPassword: 'Current Password',
    enterCurrentPassword: 'Enter current password',
    newPassword: 'New Password',
    enterNewPassword: 'Enter new password (optional)',
    leaveBlank: 'Leave blank to keep current password.',
    updateBtn: 'Update Profile',
    deactivate: 'Deactivate Account',
    confirmDeactivate: 'Are you sure you want to deactivate your account?',
    
    // Boxes
    myBoxesTitle: 'My Boxes',
    noBoxesYet: "You don't have any boxes yet.",
    createFirstBox: 'Create Your First Box',
    createNewBox: 'Create a New Box',
    editBoxTitle: 'Edit Box',
    boxName: 'Box Name',
    enterBoxName: 'Enter box name',
    selectLabelImage: 'Select Label Image',
    uploadCustomLabel: 'Or Upload Custom Label',
    labelType: 'Label Type',
    selectLabelType: 'Select label type',
    normal: 'Normal',
    hazard: 'Hazard',
    fragile: 'Fragile',
    makePrivate: 'Make this box private',
    pinCode: 'PIN Code',
    pinAutoGenerated: 'This PIN is automatically generated for private boxes.',
    contentType: 'Content Type',
    selectContentType: 'Select content type',
    text: 'Text',
    image: 'Image',
    audio: 'Audio',
    textContent: 'Text Content',
    enterBoxContent: "Enter what's inside this box...",
    uploadFile: 'Upload File',
    uploadNewFile: 'Upload New File',
    createBox: 'Create Box',
    updateBox: 'Update Box',
    viewBox: 'View Box',
    editBox: 'Edit Box',
    deleteBox: 'Delete Box',
    confirmDeleteBox: 'Are you sure you want to delete this box?',
    private: 'Private',
    public: 'Public',
    label: 'Label',
    qrCode: 'QR Code',
    clickToDownload: 'Click to download',
    
    // About Page
    welcomeTitle: 'Welcome to MoveOut!',
    welcomeSubtitle: 'Your journey towards a seamless moving experience begins here. We make your relocation process smoother, more organized, and entirely stress-free.',
    aboutMoveOut: 'About MoveOut',
    aboutDescription: 'MoveOut is an innovative, user-friendly tool designed to assist you in organizing and managing your move efficiently. Whether relocating to a new home, apartment, or office, our app empowers you to keep track of your items and boxes, ensuring that nothing gets misplaced during the transition.',
    keyFeatures: 'Key Features',
    userProfileCreation: 'User Profile Creation',
    userProfileDesc: 'Easily register and manage your moving process with a personalized account.',
    customBoxLabels: 'Custom Box Labels',
    customBoxLabelsDesc: 'Design personalized box labels with QR codes for effortless tracking.',
    inventoryManagement: 'Inventory Management',
    inventoryManagementDesc: 'Maintain an organized inventory using text, audio, and images.',
    qrCodeScanning: 'QR Code Scanning',
    qrCodeScanningDesc: 'Quickly access box contents by scanning the associated QR code.',
    effortlessOrganization: 'Effortless Organization',
    effortlessOrganizationDesc: 'Stay on top of your items and streamline your moving process effectively.',
    crossPlatform: 'Cross-Platform',
    crossPlatformDesc: 'Access your boxes from any device - mobile, tablet, or desktop.',
    securityPrivacy: 'Security & Privacy',
    encryptedData: 'Encrypted Data',
    encryptedDataDesc: 'All your data is securely encrypted using industry-standard protocols to protect your information.',
    pinProtection: 'PIN Protection',
    pinProtectionDesc: 'Protect sensitive boxes with unique PIN codes for an extra layer of security.',
    secureAuthentication: 'Secure Authentication',
    secureAuthenticationDesc: 'Multi-factor authentication and secure login options including Google OAuth.',
    privacyFirst: 'Privacy First',
    privacyFirstDesc: 'We never share your personal data. Your moving details stay private and secure.',
    whyChoose: 'Why Choose MoveOut?',
    whyChooseDesc: "We understand that moving can be a daunting experience. That's why we created MoveOut—to alleviate the stress of organizing your belongings. Our app simplifies the moving process by providing quick access to your box contents and ensuring you remain organized throughout, ultimately saving you time and effort.",
    aboutDeveloper: 'About the Developer',
    softwareEngineer: 'Software Engineer',
    developerBio: 'Passionate about creating user-friendly applications that solve real-world problems. MoveOut was developed with a focus on simplicity, security, and seamless user experience.',
    getInTouch: 'Get in Touch:',
    madeWith: 'Made with',
    by: 'by',
    
    // Verify Page
    verifyAccount: 'Verify Your Account',
    verificationCode: 'Verification Code',
    verify: 'Verify',
    
    // Forgot Password
    forgotPasswordTitle: 'Forgot Password',
    forgotPasswordInfo: "Enter your email address and we'll send you a reset code.",
    sendResetCode: 'Send Reset Code',
    backToLogin: 'Back to Login',
    
    // Reset Password
    resetPasswordTitle: 'Reset Password',
    resetPasswordInfo: 'Enter the reset code sent to your email and create a new password.',
    resetCode: 'Reset Code',
    confirmNewPassword: 'Confirm Password',
    resetPasswordBtn: 'Reset Password',
    requestNewCode: 'Request New Code',
    passwordRequirements: 'Min 8 chars, uppercase, number, special',
    confirmYourPassword: 'Confirm your password',
    
    // Reactivate
    reactivateAccount: 'Reactivate Account',
    reactivateInfo: 'Enter your email to reactivate your account',
    reactivateBtn: 'Reactivate Account',
    
    // Admin
    allUsers: 'All Users',
    activeSessions: 'Active Sessions',
    userId: 'User ID',
    status: 'Status',
    lastActivity: 'Last Activity',
    createdAt: 'Created At',
    storageUsed: 'Storage Used (KB)',
    actions: 'Actions',
    active: 'Active',
    inactive: 'Inactive',
    activate: 'Activate',
    deactivateUser: 'Deactivate',
    delete: 'Delete',
    signedInAs: 'Signed in as:',
    
    // Admin Dashboard
    adminDashboard: 'Admin Dashboard',
    adminPanelManageUsers: 'Admin Panel: Manage Users',
    sendMarketingEmails: 'Send Marketing Emails',
    subject: 'Subject',
    message: 'Message',
    sendEmails: 'Send Emails',
    deactivateInactiveUsers: 'Deactivate Inactive Users',
    inactiveUsersDeactivated: 'Inactive users deactivated successfully',
    noActiveSessions: 'No active sessions at this time.',
    loginTime: 'Login Time',
    terminate: 'Terminate',
    confirmTerminate: 'Are you sure you want to terminate this session?',
    confirmDeleteUser: 'Are you sure you want to delete this user?',
    
    // Theme
    switchToDarkMode: 'Switch to Dark Mode',
    switchToLightMode: 'Switch to Light Mode',
    
    // Footer
    copyright: '© 2024 MoveOut. All rights reserved.',
    
    // Error messages
    accountDeactivatedByAdmin: 'Your account has been deactivated by an administrator. Please contact support for assistance.',
  },
  
  sv: {
    // Navigation
    about: 'Om oss',
    admin: 'Admin',
    profile: 'Profil',
    myBoxes: 'Mina lådor',
    addBox: 'Lägg till låda',
    logout: 'Logga ut',
    login: 'Logga in',
    register: 'Registrera',
    
    // Login Page
    loginTitle: 'Logga in på MoveOut',
    email: 'E-post',
    password: 'Lösenord',
    enterEmail: 'Ange din e-post',
    enterPassword: 'Ange ditt lösenord',
    loginBtn: 'Logga in',
    forgotPassword: 'Glömt lösenord?',
    noAccount: 'Har du inget konto?',
    signUp: 'Registrera dig',
    loginWithGoogle: 'Logga in med Google',
    
    // Register Page
    signUpTitle: 'Registrera',
    createAccountInfo: 'Skapa ett konto för att börja organisera din flytt',
    name: 'Namn',
    enterName: 'Ange ditt namn',
    confirmPassword: 'Bekräfta lösenord',
    createPassword: 'Skapa ett lösenord',
    repeatPassword: 'Upprepa ditt lösenord',
    signUpBtn: 'Registrera',
    haveAccount: 'Har du redan ett konto?',
    loginHere: 'Logga in här',
    
    // Profile Page
    profileOverview: 'Profilöversikt',
    updateProfile: 'Uppdatera profil',
    currentPassword: 'Nuvarande lösenord',
    enterCurrentPassword: 'Ange nuvarande lösenord',
    newPassword: 'Nytt lösenord',
    enterNewPassword: 'Ange nytt lösenord (valfritt)',
    leaveBlank: 'Lämna tomt för att behålla nuvarande lösenord.',
    updateBtn: 'Uppdatera profil',
    deactivate: 'Inaktivera konto',
    confirmDeactivate: 'Är du säker på att du vill inaktivera ditt konto?',
    
    // Boxes
    myBoxesTitle: 'Mina lådor',
    noBoxesYet: 'Du har inga lådor än.',
    createFirstBox: 'Skapa din första låda',
    createNewBox: 'Skapa en ny låda',
    editBoxTitle: 'Redigera låda',
    boxName: 'Lådans namn',
    enterBoxName: 'Ange lådans namn',
    selectLabelImage: 'Välj etikettbild',
    uploadCustomLabel: 'Eller ladda upp egen etikett',
    labelType: 'Etiketttyp',
    selectLabelType: 'Välj etiketttyp',
    normal: 'Normal',
    hazard: 'Farligt',
    fragile: 'Ömtåligt',
    makePrivate: 'Gör denna låda privat',
    pinCode: 'PIN-kod',
    pinAutoGenerated: 'Denna PIN genereras automatiskt för privata lådor.',
    contentType: 'Innehållstyp',
    selectContentType: 'Välj innehållstyp',
    text: 'Text',
    image: 'Bild',
    audio: 'Ljud',
    textContent: 'Textinnehåll',
    enterBoxContent: 'Ange vad som finns i denna låda...',
    uploadFile: 'Ladda upp fil',
    uploadNewFile: 'Ladda upp ny fil',
    createBox: 'Skapa låda',
    updateBox: 'Uppdatera låda',
    viewBox: 'Visa låda',
    editBox: 'Redigera låda',
    deleteBox: 'Ta bort låda',
    confirmDeleteBox: 'Är du säker på att du vill ta bort denna låda?',
    private: 'Privat',
    public: 'Offentlig',
    label: 'Etikett',
    qrCode: 'QR-kod',
    clickToDownload: 'Klicka för att ladda ner',
    
    // About Page
    welcomeTitle: 'Välkommen till MoveOut!',
    welcomeSubtitle: 'Din resa mot en smidig flytt börjar här. Vi gör din flytt smidigare, mer organiserad och helt stressfri.',
    aboutMoveOut: 'Om MoveOut',
    aboutDescription: 'MoveOut är ett innovativt, användarvänligt verktyg designat för att hjälpa dig organisera och hantera din flytt effektivt. Oavsett om du flyttar till ett nytt hem, lägenhet eller kontor, ger vår app dig möjlighet att hålla koll på dina saker och lådor, så att inget försvinner under flytten.',
    keyFeatures: 'Huvudfunktioner',
    userProfileCreation: 'Skapa användarprofil',
    userProfileDesc: 'Registrera dig enkelt och hantera din flytt med ett personligt konto.',
    customBoxLabels: 'Anpassade lådetiketter',
    customBoxLabelsDesc: 'Designa personliga lådetiketter med QR-koder för enkel spårning.',
    inventoryManagement: 'Inventariehantering',
    inventoryManagementDesc: 'Håll ordning på inventariet med text, ljud och bilder.',
    qrCodeScanning: 'QR-kodskanning',
    qrCodeScanningDesc: 'Få snabb åtkomst till lådans innehåll genom att skanna QR-koden.',
    effortlessOrganization: 'Enkel organisation',
    effortlessOrganizationDesc: 'Håll koll på dina saker och effektivisera din flytt.',
    crossPlatform: 'Plattformsoberoende',
    crossPlatformDesc: 'Få åtkomst till dina lådor från valfri enhet - mobil, surfplatta eller dator.',
    securityPrivacy: 'Säkerhet & Integritet',
    encryptedData: 'Krypterad data',
    encryptedDataDesc: 'All din data är säkert krypterad med branschstandard för att skydda din information.',
    pinProtection: 'PIN-skydd',
    pinProtectionDesc: 'Skydda känsliga lådor med unika PIN-koder för extra säkerhet.',
    secureAuthentication: 'Säker autentisering',
    secureAuthenticationDesc: 'Flerfaktorsautentisering och säkra inloggningsalternativ inklusive Google OAuth.',
    privacyFirst: 'Integritet först',
    privacyFirstDesc: 'Vi delar aldrig dina personuppgifter. Din flyttinformation förblir privat och säker.',
    whyChoose: 'Varför välja MoveOut?',
    whyChooseDesc: 'Vi förstår att flytt kan vara överväldigande. Därför skapade vi MoveOut—för att minska stressen med att organisera dina tillhörigheter. Vår app förenklar flytten genom att ge snabb åtkomst till lådornas innehåll och säkerställa att du förblir organiserad, vilket sparar tid och kraft.',
    aboutDeveloper: 'Om utvecklaren',
    softwareEngineer: 'Mjukvaruingenjör',
    developerBio: 'Passionerad för att skapa användarvänliga applikationer som löser verkliga problem. MoveOut utvecklades med fokus på enkelhet, säkerhet och smidig användarupplevelse.',
    getInTouch: 'Kontakta:',
    madeWith: 'Skapad med',
    by: 'av',
    
    // Verify Page
    verifyAccount: 'Verifiera ditt konto',
    verificationCode: 'Verifieringskod',
    verify: 'Verifiera',
    
    // Forgot Password
    forgotPasswordTitle: 'Glömt lösenord',
    forgotPasswordInfo: 'Ange din e-postadress så skickar vi en återställningskod.',
    sendResetCode: 'Skicka återställningskod',
    backToLogin: 'Tillbaka till inloggning',
    
    // Reset Password
    resetPasswordTitle: 'Återställ lösenord',
    resetPasswordInfo: 'Ange återställningskoden som skickades till din e-post och skapa ett nytt lösenord.',
    resetCode: 'Återställningskod',
    confirmNewPassword: 'Bekräfta lösenord',
    resetPasswordBtn: 'Återställ lösenord',
    requestNewCode: 'Begär ny kod',
    passwordRequirements: 'Min 8 tecken, versal, siffra, specialtecken',
    confirmYourPassword: 'Bekräfta ditt lösenord',
    
    // Reactivate
    reactivateAccount: 'Återaktivera konto',
    reactivateInfo: 'Ange din e-post för att återaktivera ditt konto',
    reactivateBtn: 'Återaktivera konto',
    
    // Admin
    allUsers: 'Alla användare',
    activeSessions: 'Aktiva sessioner',
    userId: 'Användar-ID',
    status: 'Status',
    lastActivity: 'Senaste aktivitet',
    createdAt: 'Skapad',
    storageUsed: 'Lagring (KB)',
    actions: 'Åtgärder',
    active: 'Aktiv',
    inactive: 'Inaktiv',
    activate: 'Aktivera',
    deactivateUser: 'Inaktivera',
    delete: 'Ta bort',
    signedInAs: 'Inloggad som:',
    
    // Admin Dashboard
    adminDashboard: 'Administratörspanel',
    adminPanelManageUsers: 'Adminpanel: Hantera användare',
    sendMarketingEmails: 'Skicka marknadsföringsmail',
    subject: 'Ämne',
    message: 'Meddelande',
    sendEmails: 'Skicka e-post',
    deactivateInactiveUsers: 'Inaktivera inaktiva användare',
    inactiveUsersDeactivated: 'Inaktiva användare har inaktiverats',
    noActiveSessions: 'Inga aktiva sessioner just nu.',
    loginTime: 'Inloggningstid',
    terminate: 'Avsluta',
    confirmTerminate: 'Är du säker på att du vill avsluta denna session?',
    confirmDeleteUser: 'Är du säker på att du vill ta bort denna användare?',
    
    // Theme
    switchToDarkMode: 'Byt till mörkt läge',
    switchToLightMode: 'Byt till ljust läge',
    
    // Footer
    copyright: '© 2024 MoveOut. Alla rättigheter förbehållna.',
    
    // Error messages
    accountDeactivatedByAdmin: 'Ditt konto har inaktiverats av en administratör. Vänligen kontakta support för hjälp.',
  }
};

const LanguageManager = {
  init() {
    const savedLang = localStorage.getItem('moveout-lang') || 'en';
    this.setLanguage(savedLang);
  },

  setLanguage(lang) {
    localStorage.setItem('moveout-lang', lang);
    document.documentElement.setAttribute('lang', lang);
    
    // Update toggle button
    const toggleBtn = document.getElementById('lang-toggle');
    if (toggleBtn) {
      toggleBtn.innerHTML = lang === 'en' ? 'SV' : 'EN';
      toggleBtn.title = lang === 'en' ? 'Byt till Svenska' : 'Switch to English';
    }
    
    // Translate elements with data-i18n attribute
    this.translatePage(lang);
  },

  toggle() {
    const currentLang = localStorage.getItem('moveout-lang') || 'en';
    const newLang = currentLang === 'en' ? 'sv' : 'en';
    this.setLanguage(newLang);
  },

  translatePage(lang) {
    const t = translations[lang];
    
    // Translate elements with data-i18n attribute
    document.querySelectorAll('[data-i18n]').forEach(el => {
      const key = el.getAttribute('data-i18n');
      if (t[key]) {
        el.textContent = t[key];
      }
    });
    
    // Translate placeholders
    document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
      const key = el.getAttribute('data-i18n-placeholder');
      if (t[key]) {
        el.placeholder = t[key];
      }
    });
    
    // Translate title attributes
    document.querySelectorAll('[data-i18n-title]').forEach(el => {
      const key = el.getAttribute('data-i18n-title');
      if (t[key]) {
        el.title = t[key];
      }
    });
  },

  get(key) {
    const lang = localStorage.getItem('moveout-lang') || 'en';
    return translations[lang][key] || key;
  }
};

// Initialize on DOM load
document.addEventListener('DOMContentLoaded', () => {
  ThemeManager.init();
  LanguageManager.init();
});

// Export for global use
window.ThemeManager = ThemeManager;
window.LanguageManager = LanguageManager;
