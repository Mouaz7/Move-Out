<%- include("../partials/header") %>

<div class="form-container">
  <h1><i class="fas fa-box"></i> <span data-i18n="createNewBox">Create a New Box</span></h1>
  <form action="/move/boxes/create?_csrf=<%= csrfToken %>" method="POST" enctype="multipart/form-data">
    <input type="hidden" name="_csrf" value="<%= csrfToken %>" />
    <div class="form-group">
      <label for="boxName"><i class="fas fa-edit"></i> <span data-i18n="boxName">Box Name</span></label>
      <input
        type="text"
        name="boxName"
        id="boxName"
        data-i18n-placeholder="enterBoxName"
        placeholder="Enter box name"
        required
      />
    </div>

    <div class="form-group">
      <label><i class="fas fa-image"></i> <span data-i18n="selectLabelImage">Select Label Image</span></label>
      <div class="label-options">
        <div
          class="label-option"
          data-value="labe1.png"
          onclick="selectLabelImage(this)"
        >
          <img src="/style/images/labe1.png" alt="Label 1" />
        </div>
        <div
          class="label-option"
          data-value="labe2.png"
          onclick="selectLabelImage(this)"
        >
          <img src="/style/images/labe2.png" alt="Label 2" />
        </div>
        <div
          class="label-option"
          data-value="labe3.png"
          onclick="selectLabelImage(this)"
        >
          <img src="/style/images/labe3.png" alt="Label 3" />
        </div>
      </div>
      <input type="hidden" name="labelImage" id="labelImageInput" required />
      <div class="form-group" style="margin-top: 16px">
        <label for="labelImageFile"
          ><i class="fas fa-upload"></i> <span data-i18n="uploadCustomLabel">Or Upload Custom Label</span></label
        >
        <input
          type="file"
          name="labelImageFile"
          id="labelImageFile"
          accept="image/*"
        />
      </div>
    </div>

    <div class="form-group">
      <label for="labelName"><i class="fas fa-tag"></i> <span data-i18n="labelType">Label Type</span></label>
      <select name="labelName" id="labelName" required>
        <option value="" disabled selected data-i18n="selectLabelType">Select label type</option>
        <option value="normal" data-i18n="normal">Normal</option>
        <option value="hazard" data-i18n="hazard">Hazard</option>
        <option value="fragile" data-i18n="fragile">Fragile</option>
      </select>
    </div>

    <div class="form-group">
      <div class="checkbox-container">
        <input
          type="checkbox"
          name="isPrivate"
          id="isPrivate"
          onchange="togglePinField()"
        />
        <label for="isPrivate" style="margin: 0"
          ><i class="fas fa-lock"></i> <span data-i18n="makePrivate">Make this box private</span></label
        >
      </div>
    </div>

    <div id="pinField" class="form-group" style="display: none">
      <label for="pinCode"><i class="fas fa-key"></i> <span data-i18n="pinCode">PIN Code</span></label>
      <input type="text" name="pinCode" id="pinCode" readonly />
      <small class="text-muted" data-i18n="pinAutoGenerated"
        >This PIN is automatically generated for private boxes.</small
      >
    </div>

    <div class="form-group">
      <label for="contentType"><i class="fas fa-file"></i> <span data-i18n="contentType">Content Type</span></label>
      <select
        name="contentType"
        id="contentType"
        onchange="showContentInput()"
        required
      >
        <option value="" disabled selected data-i18n="selectContentType">Select content type</option>
        <option value="text" data-i18n="text">Text</option>
        <option value="image" data-i18n="image">Image</option>
        <option value="audio" data-i18n="audio">Audio</option>
      </select>
    </div>

    <div id="textInput" class="form-group" style="display: none">
      <label for="contentText"
        ><i class="fas fa-align-left"></i> <span data-i18n="textContent">Text Content</span></label
      >
      <textarea
        name="contentText"
        id="contentText"
        rows="4"
        data-i18n-placeholder="enterBoxContent"
        placeholder="Enter what's inside this box..."
      ></textarea>
    </div>

    <div id="fileInput" class="form-group" style="display: none">
      <label for="contentFile"
        ><i class="fas fa-cloud-upload-alt"></i> <span data-i18n="uploadFile">Upload File</span></label
      >
      <input
        type="file"
        name="contentFile"
        id="contentFile"
        accept="image/*,audio/*"
      />
    </div>

    <button type="submit"><i class="fas fa-plus-circle"></i> <span data-i18n="createBox">Create Box</span></button>
  </form>
</div>

<script nonce="<%= cspNonce %>">
  function selectLabelImage(label) {
    document.querySelectorAll(".label-option").forEach((option) => {
      option.classList.remove("selected");
    });
    label.classList.add("selected");
    document.getElementById("labelImageInput").value = label.dataset.value;
  }

  function showContentInput() {
    const contentType = document.getElementById("contentType").value;
    const textInput = document.getElementById("textInput");
    const fileInput = document.getElementById("fileInput");

    textInput.style.display = "none";
    fileInput.style.display = "none";

    if (contentType === "text") {
      textInput.style.display = "block";
    } else if (contentType === "image" || contentType === "audio") {
      fileInput.style.display = "block";
    }
  }

  function togglePinField() {
    const isPrivate = document.getElementById("isPrivate").checked;
    const pinField = document.getElementById("pinField");
    pinField.style.display = isPrivate ? "block" : "none";

    if (isPrivate) {
      document.getElementById("pinCode").value = Math.floor(
        100000 + Math.random() * 900000
      ).toString();
    } else {
      document.getElementById("pinCode").value = "";
    }
  }

  document.addEventListener("DOMContentLoaded", function () {
    document.getElementById("pinField").style.display = "none";
    showContentInput();
  });
</script>

<%- include("../partials/footer") %>
